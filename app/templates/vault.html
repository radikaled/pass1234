{% extends "base.html" %}

{% block content %}
    <script>
    function togglePasswordVisibility() {
        const passwordField = document.getElementById('passwordField');
        const toggleIcon = document.getElementById('toggleIcon');
        
        if (passwordField.type === "password") {
            passwordField.type = "text";
            toggleIcon.classList.remove("fa-eye");
            toggleIcon.classList.add("fa-eye-slash");
        } else {
            passwordField.type = "password";
            toggleIcon.classList.remove("fa-eye-slash");
            toggleIcon.classList.add("fa-eye");
        }
    }
    </script>
    <div class="box">
    <!-- Top-right "Add New Credential" link -->
    <div class="level">
        <div class="level-left">
            <h2 class="title is-4">My Vault</h2>
        </div>
        <div class="level-right">
            <a href="{{ url_for('vault.create') }}" class="button is-primary is-light">
                <span class="icon">
                    <i class="fa-solid fa-key"></i>
                </span>
                <span>Add New Credential</span>
            </a>
        </div>
    </div>
        <table class="table is-fullwidth is-striped table is-hoverable has-text-left">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Website</th>
                    <th>Username</th>
                    <th>Password</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            {% for credential in credentials %}
                <tr>
                    <td>{{ credential.name }}</td>
                    <td>{{ credential.website }}</td>
                    <td>{{ credential.username }}</td>
                    <td>
                        <div class="field">
                            <div class="control has-icons-right">
                                <input class="input is-static" id="passwordField" type="password" value="{{ credential.ciphertext }}" readonly>
                                <span class="icon is-small is-right" onclick="togglePasswordVisibility()">
                                    <i id="toggleIcon" class="fas fa-eye is-clickable"></i>
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="field is-grouped">
                            <div class="control">
                                <a href="{{ url_for('vault.edit', credential_id=credential.id) }}" class="button is-link is-light">
                                    <span class="icon">
                                        <i class="fa-regular fa-pen-to-square"></i>
                                    </span>
                                    <span>Edit</span>
                                </a>
                            </div>
                            <div class="control">
                            <form method="POST" action="{{ url_for('vault.delete', credential_id=credential.id) }}" style="display: contents;">
                                <button class="button is-danger is-light"
                                    onclick="return confirm('Are you sure you want to delete this entry?')">
                                    <span class="icon">
                                        <i class="fa-regular fa-trash-can"></i>
                                    </span>
                                    <span>Delete</span>
                                </button>
                            </form>
                            </div>
                            <div class="control">
                                <a href="{{ url_for('vault.share', credential_id=credential.id) }}" class="button is-link is-light">
                                    <span class="icon">
                                        <i class="fa-regular fa-handshake"></i>
                                    </span>
                                    <span>Share</span>
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}